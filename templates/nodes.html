<!doctype html>
<html lang="en" data-bs-theme="dark">
{% include "head.html" %}

<body>
    <div class="container">
        <div class="row mx-auto"><img class="logo flex-d mx-auto" src="{{ url_for('static', path='img/logo.svg') }}">
        </div>
    </div>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse text-center" id="navbarNav">
                {% include "nav.html" %}
            </div>
        </div>
    </nav>

        <div id="map" class="mx-auto"></div>

        <script>
            var root = am5.Root.new("map");
            root._logo.dispose();

            root.setThemes([
                am5themes_Animated.new(root)
            ]);

            var chart = root.container.children.push(
                am5map.MapChart.new(root, {
                    panX: "rotateX",
                    panY: "translateY",
                    projection: am5map.geoMercator(),
                })
            );

            var polygonSeries = chart.series.push(
                am5map.MapPolygonSeries.new(root, {
                    geoJSON: am5geodata_worldLow,
                    exclude: ["AQ"]
                })
            );

            polygonSeries.mapPolygons.template.setAll({
                fill: am5.color(0x119eaa)
            });

            var pointSeries = chart.series.push(am5map.ClusteredPointSeries.new(root, {}));

            pointSeries.set("clusteredBullet", function (root) {
                var container = am5.Container.new(root, {
                    cursorOverStyle: "pointer"
                });

                var circle1 = container.children.push(am5.Circle.new(root, {
                    radius: 8,
                    tooltipY: 0,
                    fill: am5.color(0xff8c00)
                }));

                var circle2 = container.children.push(am5.Circle.new(root, {
                    radius: 12,
                    fillOpacity: 0.3,
                    tooltipY: 0,
                    fill: am5.color(0xff8c00)
                }));

                var circle3 = container.children.push(am5.Circle.new(root, {
                    radius: 16,
                    fillOpacity: 0.3,
                    tooltipY: 0,
                    fill: am5.color(0xff8c00)
                }));

                var label = container.children.push(am5.Label.new(root, {
                    centerX: am5.p50,
                    centerY: am5.p50,
                    fill: am5.color(0xffffff),
                    populateText: true,
                    fontSize: "8",
                    text: "{value}"
                }));

                container.events.on("click", function (e) {
                    pointSeries.zoomToCluster(e.target.dataItem);
                });

                return am5.Bullet.new(root, {
                    sprite: container
                });
            });

            pointSeries.bullets.push(function () {
                var circle = am5.Circle.new(root, {
                    radius: 6,
                    tooltipY: -10,
                    fill: am5.color(0xff8c00),
                    tooltipHTML: "{title}"
                });

                return am5.Bullet.new(root, {
                    sprite: circle
                });
            });

            var cities = [
                {% for point in node_info %}
            {
                title: "<strong>Node address:</strong> {{point[1]}}<br><strong>Country:</strong> {{point[16]}}<br><strong>Staked amount: </strong>{{point[6]}} mCELL<br><strong>Weight:</strong> {{ " % .2f"|format(point[7]) }}%",
                latitude: "{{point[13]}}",
                longitude: "{{point[14]}}"
            }
            {% if not loop.last %}, {% endif %}
            {% endfor %}
            ];

            for (var i = 0; i < cities.length; i++) {
                var city = cities[i];
                addCity(city.longitude, city.latitude, city.title);
            }

            function addCity(longitude, latitude, title) {
                pointSeries.data.push({
                    geometry: { type: "Point", coordinates: [longitude, latitude] },
                    title: title
                });
            }

            chart.appear(4000, 100);
        </script>
    <div class="container-flex">
    {% include "footer.html" %}
    </div>
</body>

</html>